# 1. 核心需求
开发一个校园二手图书交易商城，支持用户发布、浏览、交易二手图书，交易采用自提自付款方式，功能覆盖用户注册登录、图书管理、订单流转、评价反馈等核心流程。

## 2. 技术约束

| 类型 | 约束条件            |
| ---- | ------------------- |
| 前端 | arco.design vue版本，兼容Chrome 90+、Firefox 85+、微信小程序基础库2.25.0+ |
| 后端 | FastApi 0.68.0 + SQLModel 0.0.8，Python 3.9+ |
| 部署 | MySQL 9.3.0（主机localhost:3306，用户名root/密码root），Nginx 1.21.6作为反向代理 |

## 3. 需求功能

### 3.1 用户身份管理

#### 需求 1：用户注册
**用户故事：** 作为新用户，我希望通过手机号+验证码注册账号以便参与图书交易。

##### 验收标准
1. 输入未注册的手机号，点击获取验证码，系统应在60秒内发送短信验证码（测试用：1234）<mcreference link="https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder" index="1">1</mcreference>。
2. 输入正确验证码并设置6-16位包含字母+数字的密码，点击注册，系统应返回成功提示并跳转登录页。

> ##### 类型：通用性
##### 处理逻辑：
```mermaid
graph TD
A[输入手机号] --> B{手机号格式校验}
B -->|有效| C[发送验证码]
B -->|无效| D[提示"手机号格式错误"]
C --> E[输入验证码+密码]
E --> F{验证码匹配}
F -->|是| G[创建用户记录]
F -->|否| H[提示"验证码错误"]
G --> I[注册成功]
```

### 3.2 图书交易流程

#### 需求 2：图书发布
**用户故事：** 作为卖家，我希望上传图书信息（名称/作者/ISBN/新旧程度/价格）并设置自提地点以便其他用户浏览。

##### 验收标准
1. 填写必填字段（名称/价格），上传1-5张图书图片，系统应自动校验ISBN有效性（通过API查询图书信息）。
2. 选择自提地点（精确到宿舍楼），点击发布，系统应生成唯一图书ID并展示在"我的发布"列表。

> ##### 类型：事件驱动
##### 处理逻辑：
```mermaid
graph TD
A[填写图书信息] --> B{ISBN校验}
B -->|有效| C[图片上传（≤5张）]
B -->|无效| D[提示"ISBN不存在"]
C --> E[选择自提地点]
E --> F{信息完整}
F -->|是| G[生成图书记录]
F -->|否| H[提示"请完善必填信息"]
G --> I[发布成功]
```

## 4. 非功能需求

### 4.1 性能指标

| 场景      | 要求         | 验证方式     |
| --------- | ------------ | ------------ |
| 首页加载  | ≤2s（2G网络） | Lighthouse测试 |
| 图书搜索  | ≤500ms       | JMeter压测（100并发） |

### 4.2 安全需求
- 🔒 密码采用bcrypt算法加盐哈希存储（盐值长度12位）
- 🔒 输入内容过滤XSS脚本（使用FastApi的安全中间件）
- 🔒 数据库连接使用SSL加密（MySQL配置require_secure_transport=ON）

### 4.3 兼容性

| 平台      | 支持版本     |
| --------- | ------------ |
| 微信小程序 | 基础库≥2.25.0 |
| PC浏览器  | Chrome≥90, Firefox≥85 |
| Android   | 系统≥9.0     |
| iOS       | 系统≥13.0    |