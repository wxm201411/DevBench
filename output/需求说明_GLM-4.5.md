# 校园二手图书交易商城需求说明文档

## 1. 系统概述

### 1.1 项目背景
开发一个校园二手图书交易商城，交易采用类似闲鱼APP的自提自付款方式。

### 1.2 技术架构
- 前端：arco.design vue版本
- 后端：FastApi+SQLModel
- 数据库：MySQL9.3.0
  - 主机：localhost
  - 端口：3306
  - 用户名：root
  - 密码：root

## 2. 功能需求（EARS规范）

### 2.1 用户管理模块

**需求1：用户注册功能**
- 当用户访问系统时，系统应提供用户注册功能
- 用户填写必要信息并提交后，系统应创建用户账户
- 注册成功后，系统应返回注册成功信息

**需求2：用户登录功能**
- 当已注册用户访问系统时，系统应提供用户登录功能
- 用户输入正确的用户名和密码后，系统应验证用户身份
- 验证通过后，系统应允许用户访问系统功能

**需求3：用户信息管理功能**
- 当用户登录系统后，系统应提供用户信息管理功能
- 用户修改个人信息并提交后，系统应更新用户信息
- 更新成功后，系统应显示更新成功信息

### 2.2 图书管理模块

**需求4：图书发布功能**
- 当用户登录系统后，系统应提供图书发布功能
- 用户填写图书信息并上传图片后，系统应保存图书信息
- 发布成功后，系统应显示发布成功信息

**需求5：图书搜索功能**
- 当用户访问系统时，系统应提供图书搜索功能
- 用户输入搜索条件后，系统应返回匹配的图书列表
- 搜索结果应包含图书的基本信息和价格

**需求6：图书详情查看功能**
- 当用户查看图书列表时，系统应提供图书详情查看功能
- 用户点击图书后，系统应显示图书的详细信息
- 详情应包含图书描述、价格、卖家信息等

### 2.3 交易管理模块

**需求7：自提交易功能**
- 当用户购买图书时，系统应提供自提交易功能
- 用户选择自提方式后，系统应记录交易信息
- 交易成功后，系统应通知买卖双方交易详情

**需求8：自付款功能**
- 当用户确认收到图书后，系统应提供自付款功能
- 用户确认付款后，系统应更新交易状态
- 付款成功后，系统应通知卖家收款信息

**需求9：交易评价功能**
- 当交易完成后，系统应提供交易评价功能
- 用户填写评价内容并提交后，系统应保存评价信息
- 评价成功后，系统应更新用户信用评级

### 2.4 消息通知模块

**需求10：交易通知功能**
- 当交易状态发生变化时，系统应发送交易通知
- 系统应通过站内消息通知相关用户
- 通知应包含交易状态变更的详细信息

**需求11：系统消息功能**
- 当系统有重要公告时，系统应发送系统消息
- 系统应向所有用户推送重要公告
- 用户应能查看历史系统消息

## 3. 非功能需求

### 3.1 性能需求
- 系统应支持至少1000个用户同时在线
- 页面加载时间应不超过3秒
- 数据库查询响应时间应不超过1秒

### 3.2 安全需求
- 用户密码应加密存储
- 用户敏感信息应加密传输
- 系统应防止SQL注入和XSS攻击

### 3.3 可用性需求
- 系统应提供7×24小时服务
- 系统可用性应达到99.9%
- 系统应具备故障恢复能力

## 4. 数据库设计

### 4.1 用户表（users）
- id：主键，自增
- username：用户名，唯一
- password：密码，加密存储
- email：邮箱，唯一
- phone：手机号
- created_at：创建时间
- updated_at：更新时间

### 4.2 图书表（books）
- id：主键，自增
- title：图书标题
- author：作者
- publisher：出版社
- price：价格
- description：描述
- image_url：图片URL
- seller_id：卖家ID，外键
- status：状态（在售、已售、下架）
- created_at：创建时间
- updated_at：更新时间

### 4.3 交易表（transactions）
- id：主键，自增
- book_id：图书ID，外键
- buyer_id：买家ID，外键
- seller_id：卖家ID，外键
- price：交易价格
- status：交易状态（待付款、已完成、已取消）\- pickup_location：自提地点
- created_at：创建时间
- updated_at：更新时间

### 4.4 评价表（reviews）
- id：主键，自增
- transaction_id：交易ID，外键
- reviewer_id：评价人ID，外键
- reviewed_id：被评价人ID，外键
- rating：评分（1-5分）
- comment：评价内容
- created_at：创建时间

## 5. 接口设计

### 5.1 用户接口
- POST /api/users/register：用户注册
- POST /api/users/login：用户登录
- GET /api/users/profile：获取用户信息
- PUT /api/users/profile：更新用户信息

### 5.2 图书接口
- POST /api/books：发布图书
- GET /api/books：获取图书列表
- GET /api/books/{id}：获取图书详情
- PUT /api/books/{id}：更新图书信息
- DELETE /api/books/{id}：删除图书

### 5.3 交易接口
- POST /api/transactions：创建交易
- GET /api/transactions：获取交易列表
- GET /api/transactions/{id}：获取交易详情
- PUT /api/transactions/{id}/status：更新交易状态
- POST /api/transactions/{id}/payment：确认付款

### 5.4 评价接口
- POST /api/reviews：提交评价
- GET /api/reviews：获取评价列表
- GET /api/reviews/{id}：获取评价详情

## 6. 部署要求

### 6.1 环境要求
- 操作系统：Windows/Linux
- Python版本：3.8+
- Node.js版本：14+
- MySQL版本：9.3.0

### 6.2 配置要求
- 前端服务器：Nginx/Apache
- 后端服务器：Uvicorn
- 数据库服务器：MySQL

### 6.3 安全配置
- 启用HTTPS
- 配置防火墙
- 定期备份数据库