# 校园二手图书交易商城需求说明文档

## 1. 项目概述

### 1.1 项目背景
随着高校学生对教材和学习资料需求的增长，二手图书交易市场在校园内日益活跃。传统的线下交易方式存在信息不对称、交易效率低、信任度不足等问题。因此，需要开发一个专门针对校园场景的二手图书交易商城系统，为在校学生提供便捷、安全、高效的图书交易服务。

### 1.2 项目目标
构建一个基于校园场景的二手图书交易商城，采用类似闲鱼APP的自提自付款交易模式，为在校学生提供图书信息发布、搜索、交易撮合等服务，解决传统二手书交易中的痛点问题。

## 2. 需求规范（遵循EARS方法）

### 2.1 功能性需求

#### 2.1.1 用户管理
- **用户注册**：当学生首次使用系统时，系统应该允许其使用学号和校园邮箱进行注册。
- **用户登录**：当已注册用户想要使用系统功能时，系统应该允许其通过学号和密码进行登录。
- **用户信息管理**：当用户需要更新个人信息时，系统应该允许其修改头像、联系方式、收货地址等信息。
- **实名认证**：当用户发布图书信息或进行交易时，系统应该要求其完成实名认证，包括上传学生证照片。

#### 2.1.2 图书管理
- **图书信息发布**：当用户想要出售二手图书时，系统应该允许其发布图书信息，包括书名、ISBN、作者、出版社、原价、售价、图书成色、实物照片等。
- **图书信息编辑**：当用户需要修改已发布的图书信息时，系统应该允许其对除ISBN外的其他信息进行编辑。
- **图书信息删除**：当用户不再出售某本图书时，系统应该允许其删除该图书的发布信息。
- **图书搜索**：当用户想要查找特定图书时，系统应该支持按书名、作者、ISBN、课程名称等关键词进行搜索。
- **图书筛选**：当用户浏览图书列表时，系统应该支持按价格区间、图书成色、出版年份、学院专业等条件进行筛选。

#### 2.1.3 交易管理
- **交易发起**：当买家想要购买某本图书时，系统应该允许其向卖家发起交易申请。
- **交易确认**：当卖家收到交易申请时，系统应该允许其选择接受或拒绝该申请。
- **交易状态跟踪**：当交易进行中时，系统应该实时更新交易状态（待确认、已确认、待自提、已完成、已取消）。
- **交易取消**：当交易双方协商一致或特殊情况发生时，系统应该允许双方取消交易。
- **交易评价**：当交易完成后，系统应该允许双方对交易过程进行评价和评分。

#### 2.1.4 自提管理
- **自提点设置**：当用户发布图书时，系统应该允许其设置自提点位置（宿舍楼、教学楼、图书馆等校园内地点）。
- **自提时间协商**：当交易确认后，系统应该支持买卖双方协商确定具体的自提时间。
- **自提码生成**：当交易双方确认自提后，系统应该为买家生成唯一的自提码。
- **自提完成确认**：当买家成功自提图书后，系统应该允许卖家确认交易完成。

#### 2.1.5 支付管理
- **线下支付**：当交易双方选择线下支付时，系统应该记录交易金额但不涉及实际资金流转。
- **支付状态记录**：当买家完成线下支付后，系统应该允许卖家标记支付状态为已支付。
- **支付纠纷处理**：当出现支付争议时，系统应该提供客服介入渠道。

### 2.2 非功能性需求

#### 2.2.1 性能需求
- **响应时间**：当用户进行操作时，系统应该在2秒内响应用户请求。
- **并发处理**：当系统高峰期有1000个并发用户时，系统应该保持稳定运行。
- **图片加载**：当用户浏览图书图片时，系统应该在1秒内完成图片加载。

#### 2.2.2 安全需求
- **数据安全**：当用户上传个人信息和图片时，系统应该确保数据加密存储。
- **身份验证**：当用户进行敏感操作时，系统应该进行二次身份验证。
- **权限控制**：当用户访问系统资源时，系统应该根据其角色（买家、卖家、管理员）控制访问权限。

#### 2.2.3 可用性需求
- **系统可用性**：系统应该保证99%以上的可用性，年停机时间不超过87.6小时。
- **故障恢复**：当系统出现故障时，系统应该在30分钟内完成故障恢复。
- **数据备份**：系统应该每日进行数据备份，确保数据可恢复性。

#### 2.2.4 兼容性需求
- **浏览器兼容**：系统应该支持Chrome、Firefox、Safari、Edge等主流浏览器。
- **移动端适配**：当用户在移动设备访问时，系统应该提供良好的移动端体验。
- **响应式设计**：系统应该支持不同屏幕尺寸的自适应显示。

## 3. 技术架构

### 3.1 前端技术栈
- **框架**：Arco Design Vue版本
- **构建工具**：Vite
- **状态管理**：Pinia
- **路由**：Vue Router
- **HTTP客户端**：Axios

### 3.2 后端技术栈
- **框架**：FastAPI
- **ORM**：SQLModel
- **数据库**：MySQL 9.3.0
- **连接配置**：
  - 主机：localhost
  - 端口：3306
  - 用户名：root
  - 密码：root
- **身份验证**：JWT Token
- **文件存储**：本地文件系统/云存储

### 3.3 部署架构
- **容器化**：Docker
- **反向代理**：Nginx
- **进程管理**：Gunicorn/Uvicorn
- **监控**：Prometheus + Grafana

## 4. 数据模型设计

### 4.1 用户表（users）
- id：主键
- student_id：学号（唯一）
- email：校园邮箱
- password_hash：密码哈希
- real_name：真实姓名
- avatar：头像URL
- phone：手机号
- address：常用收货地址
- is_verified：实名认证状态
- created_at：创建时间
- updated_at：更新时间

### 4.2 图书表（books）
- id：主键
- user_id：外键（关联用户）
- isbn：ISBN号
- title：书名
- author：作者
- publisher：出版社
- original_price：原价
- selling_price：售价
- condition：成色（1-10级）
- description：详细描述
- images：图片URLs（JSON数组）
- pickup_location：自提点
- status：状态（在售/已售/已下架）
- created_at：发布时间
- updated_at：更新时间

### 4.3 交易表（transactions）
- id：主键
- buyer_id：买家ID
- seller_id：卖家ID
- book_id：图书ID
- status：交易状态
- pickup_code：自提码
- pickup_time：约定自提时间
- payment_status：支付状态
- created_at：创建时间
- updated_at：更新时间

### 4.4 评价表（reviews）
- id：主键
- transaction_id：交易ID
- reviewer_id：评价人ID
- reviewee_id：被评价人ID
- rating：评分（1-5星）
- comment：评价内容
- created_at：创建时间

## 5. 界面设计规范

### 5.1 设计原则
- **简洁性**：界面设计简洁明了，避免过多视觉干扰
- **一致性**：保持设计风格和交互方式的一致性
- **易用性**：符合用户直觉，降低学习成本
- **校园风格**：采用青春活力的配色方案，体现校园文化特色

### 5.2 页面结构
- **首页**：图书推荐、搜索入口、分类导航
- **搜索页**：搜索结果、筛选条件、排序方式
- **详情页**：图书详情、卖家信息、交易操作
- **个人中心**：我的发布、我的交易、个人信息
- **发布页**：图书信息填写、图片上传

### 5.3 组件规范
- **颜色方案**：主色调采用Arco Design蓝色系，辅助色采用绿色和橙色
- **字体规范**：标题使用思源黑体，正文使用系统默认字体
- **图标风格**：使用线性图标，保持简洁一致的视觉风格
- **按钮规范**：主按钮采用填充样式，次要按钮采用描边样式

## 6. 接口设计规范

### 6.1 RESTful API设计
- **基础路径**：/api/v1
- **版本控制**：通过URL路径进行版本控制
- **状态码**：统一使用HTTP状态码表示操作结果
- **响应格式**：统一使用JSON格式返回数据

### 6.2 主要接口

#### 6.2.1 用户相关
- POST /api/v1/users/register - 用户注册
- POST /api/v1/users/login - 用户登录
- GET /api/v1/users/profile - 获取用户信息
- PUT /api/v1/users/profile - 更新用户信息
- POST /api/v1/users/verify - 实名认证

#### 6.2.2 图书相关
- GET /api/v1/books - 获取图书列表（支持分页、筛选、搜索）
- POST /api/v1/books - 发布图书信息
- GET /api/v1/books/{id} - 获取图书详情
- PUT /api/v1/books/{id} - 更新图书信息
- DELETE /api/v1/books/{id} - 删除图书信息
- POST /api/v1/books/{id}/images - 上传图书图片

#### 6.2.3 交易相关
- POST /api/v1/transactions - 发起交易
- GET /api/v1/transactions - 获取交易列表
- GET /api/v1/transactions/{id} - 获取交易详情
- PUT /api/v1/transactions/{id}/accept - 卖家确认交易
- PUT /api/v1/transactions/{id}/cancel - 取消交易
- PUT /api/v1/transactions/{id}/complete - 完成交易

#### 6.2.4 评价相关
- POST /api/v1/reviews - 创建评价
- GET /api/v1/reviews/user/{user_id} - 获取用户评价

## 7. 测试策略

### 7.1 测试类型
- **单元测试**：对核心业务逻辑进行单元测试
- **集成测试**：测试API接口和数据库交互
- **端到端测试**：测试完整的用户操作流程
- **性能测试**：测试系统在高并发下的表现
- **安全测试**：测试系统的安全防护能力

### 7.2 测试工具
- **后端测试**：pytest、pytest-asyncio
- **前端测试**：Vitest、Vue Test Utils
- **API测试**：Postman/Newman
- **性能测试**：Locust
- **安全测试**：OWASP ZAP

## 8. 部署计划

### 8.1 开发环境
- **本地开发**：使用Docker Compose搭建完整开发环境
- **数据库**：使用MySQL 9.3.0本地实例
- **前端开发**：使用Vite开发服务器
- **后端开发**：使用Uvicorn热重载模式

### 8.2 测试环境
- **测试服务器**：阿里云ECS实例
- **域名配置**：使用测试域名进行访问
- **SSL证书**：使用Let's Encrypt免费证书
- **监控告警**：配置基础监控告警

### 8.3 生产环境
- **服务器配置**：阿里云ECS 4核8G内存
- **数据库**：阿里云RDS MySQL 9.3.0
- **CDN**：配置阿里云CDN加速静态资源
- **备份策略**：每日自动备份数据库和文件
- **监控体系**：Prometheus + Grafana + 钉钉告警

## 9. 风险评估与应对

### 9.1 技术风险
- **数据库性能**：采用读写分离、分库分表策略
- **图片存储**：初期使用本地存储，后期迁移到OSS
- **并发处理**：使用Redis缓存热点数据
- **安全漏洞**：定期进行安全扫描和代码审计

### 9.2 业务风险
- **虚假交易**：建立用户信誉体系，实名认证机制
- **图书质量**：建立图书成色标准，支持退货机制
- **交易纠纷**：建立客服介入机制，提供仲裁服务
- **用户流失**：优化用户体验，建立积分奖励机制

## 10. 项目里程碑

### 10.1 第一阶段（1-2周）
- 完成项目初始化和技术选型
- 搭建开发环境和基础框架
- 完成数据库设计和API设计
- 实现用户注册登录功能

### 10.2 第二阶段（2-3周）
- 实现图书发布和管理功能
- 实现图书搜索和筛选功能
- 完成图书详情页面
- 实现图片上传功能

### 10.3 第三阶段（2-3周）
- 实现交易发起和确认流程
- 完成自提管理功能
- 实现交易状态跟踪
- 完成评价系统

### 10.4 第四阶段（1-2周）
- 完成用户个人中心
- 优化用户体验和界面
- 进行全面测试
- 部署测试环境

### 10.5 第五阶段（1周）
- 生产环境部署
- 性能优化和监控配置
- 用户培训和推广
- 正式上线运营

## 11. 总结

本需求说明文档详细描述了校园二手图书交易商城的功能需求、技术架构、数据模型、接口设计等关键要素。项目采用EARS需求规范方法，确保需求的完整性和可追踪性。通过Arco Design Vue前端框架和FastAPI后端框架的组合，结合MySQL数据库，构建一个安全、高效、易用的校园二手图书交易平台。项目将分阶段实施，确保按时交付高质量的系统产品。